<!DOCTYPE html>
<html>

<head lang="en">
    <title>Volume Control Settings</title>
    <meta charset="utf-8" />
    <script src="https://sdpi-components.dev/releases/v3/sdpi-components.js"></script>
</head>

<body>
    <!--
        Learn more about property inspector components at https://sdpi-components.dev/docs/components
    -->
    <sdpi-item label="Host">
        <sdpi-textfield setting="host" required placeholder="receiver.local"></sdpi-textfield>
    </sdpi-item>
    <sdpi-item label="Port">
        <sdpi-textfield setting="port" required placeholder="23"></sdpi-textfield>
    </sdpi-item>
    <sdpi-item>
        <sdpi-button onclick="connect(this)">Connect</sdpi-button>
    </sdpi-item>
    <sdpi-item label="Status">
        <sdpi-textfield id="status" disabled></sdpi-textfield>
    </sdpi-item>

    <script>
        const { streamDeckClient } = SDPIComponents;

        function updateStatusText(text) {
            let statusField = document.getElementById('status');
            statusField.removeAttribute('disabled');
            statusField.value = text;
            statusField.setAttribute('disabled', 'true');
        }

        function connect(e) {
            streamDeckClient.send('sendToPlugin', { message: 'connect' });
        }

        streamDeckClient.didReceiveSettings.subscribe((ev) => {
            if (ev.settings) {
                if (ev.settings.host) {
                    document.getElementById('host').value = ev.settings.host;
                }
                if (ev.settings.port) {
                    document.getElementById('port').value = ev.settings.port;
                }
            }
        });

        streamDeckClient.sendToPropertyInspector.subscribe((ev) => {
            if (ev.payload && ev.payload.message === "status" && ev.payload.details) {
                updateStatusText(ev.payload.details);
            }
        });
    </script>
</body>

</html>